

// coords = 
// [[82.415,-9.5,82.415,9.5],
// [81.914,-9.5,81.914,9.5],
// [81.413,-9.5,81.413,9.5],
// [80.912,-9.5,80.912,9.5],
// [80.411,-9.5,80.411,9.5],
// [79.91,-9.5,79.91,9.5],
// [79.409,-9.5,79.409,9.5],
// [78.908,-9.5,78.908,9.5],
// [78.407,-9.5,78.407,9.5],
// [77.906,-9.5,77.906,9.5],
// [77.405,-9.5,77.405,9.5],
// [76.904,-9.5,76.904,9.5],
// [76.403,-9.5,76.403,9.5],
// [75.902,-9.5,75.902,9.5],
// [75.401,-9.5,75.401,9.5],
// [74.9,-9.5,74.9,9.5],
// [74.399,-9.5,74.399,9.5],
// [73.898,-9.5,73.898,9.5],
// [73.397,-9.5,73.397,9.5],
// [72.896,-9.5,72.896,9.5],
// [72.395,-9.5,72.395,9.5],
// [71.894,-9.5,71.894,9.5],
// [71.393,-9.5,71.393,9.5],
// [70.892,-9.5,70.892,9.5],
// [70.391,-9.5,70.391,9.5],
// [69.89,-9.5,69.89,9.5],
// [69.389,-9.5,69.389,9.5],
// [68.888,-9.5,68.888,9.5],
// [68.387,-9.5,68.387,9.5],
// [67.886,-9.5,67.886,9.5],
// [67.385,-9.5,67.385,9.5],
// [66.884,-9.5,66.884,9.5],
// [66.383,-9.5,66.383,9.5],
// [65.882,-9.5,65.882,9.5],
// [65.381,-9.5,65.381,9.5],
// [64.88,-9.5,64.88,9.5],
// [64.379,-9.5,64.379,9.5],
// [63.878,-9.5,63.878,9.5],
// [63.377,-9.5,63.377,9.5],
// [62.876,-9.5,62.876,9.5],
// [62.375,-9.5,62.375,9.5],
// [61.874,-9.5,61.874,9.5],
// [61.373,-9.5,61.373,9.5],
// [60.872,-9.5,60.872,9.5],
// [60.371,-9.5,60.371,9.5],
// [59.87,-9.5,59.87,9.5],
// [59.369,-9.5,59.369,9.5],
// [58.868,-9.5,58.868,9.5],
// [58.367,-9.5,58.367,9.5],
// [57.866,-9.5,57.866,9.5],
// [57.365,-9.5,57.365,9.5],
// [56.864,-9.5,56.864,9.5],
// [56.363,-9.5,56.363,9.5],
// [55.862,-9.5,55.862,9.5],
// [55.361,-9.5,55.361,9.5],
// [54.86,-9.5,54.86,9.5],
// [54.359,-9.5,54.359,9.5],
// [53.858,-9.5,53.858,9.5],
// [53.357,-9.5,53.357,9.5],
// [52.856,-9.5,52.856,9.5],
// [52.355,-9.5,52.355,9.5],
// [51.854,-9.5,51.854,9.5],
// [51.353,-9.5,51.353,9.5],
// [50.852,-9.5,50.852,9.5],
// [50.351,-9.5,50.351,9.5],
// [49.85,-9.5,49.85,9.5],
// [49.349,-9.417,49.349,9.417],
// [48.848,-9.276,48.848,9.276],
// [48.347,-9.139,48.347,9.139],
// [47.846,-9.005,47.846,9.005],
// [47.345,-8.874,47.345,8.874],
// [46.844,-8.749,46.844,8.749],
// [46.343,-8.624,46.343,8.624],
// [45.842,-8.507,45.842,8.507],
// [45.341,-8.39,45.341,8.39],
// [44.84,-8.279,44.84,8.279],
// [44.339,-8.17,44.339,8.17],
// [43.838,-8.066,43.838,8.066],
// [43.337,-7.964,43.337,7.964],
// [42.836,-7.866,42.836,7.866],
// [42.335,-7.772,42.335,7.772],
// [41.834,-7.68,41.834,7.68],
// [41.333,-7.593,41.333,7.593],
// [40.832,-7.507,40.832,7.507],
// [40.331,-7.429,40.331,7.429],
// [39.83,-7.35,39.83,7.35],
// [39.329,-7.277,39.329,7.277],
// [38.828,-7.206,38.828,7.206],
// [38.327,-7.14,38.327,7.14],
// [37.826,-7.076,37.826,7.076],
// [37.325,-7.015,37.325,7.015],
// [36.824,-6.959,36.824,6.959],
// [36.323,-6.904,36.323,6.904],
// [35.822,-6.856,35.822,6.856],
// [35.321,-6.807,35.321,6.807],
// [34.82,-6.765,34.82,6.765],
// [34.319,-6.724,34.319,6.724],
// [33.818,-6.688,33.818,6.688],
// [33.317,-6.655,33.317,6.655],
// [32.816,-6.624,32.816,6.624],
// [32.315,-6.598,32.315,6.598],
// [31.814,-6.573,31.814,6.573],
// [31.313,-6.554,31.313,6.554],
// [30.812,-6.536,30.812,6.536],
// [30.311,-6.524,30.311,6.524],
// [29.81,-6.513,29.81,6.513],
// [29.309,-6.506,29.309,6.506],
// [28.808,-6.502,28.808,6.502],
// [28.307,-6.5,28.307,6.5],
// [27.806,-6.5,27.806,6.5],
// [27.305,-6.5,27.305,6.5],
// [26.804,-6.5,26.804,6.5],
// [26.303,-6.5,26.303,6.5],
// [25.802,-6.5,25.802,6.5],
// [25.301,-6.5,25.301,6.5],
// [24.8,-6.5,24.8,6.5],
// [24.299,-6.5,24.299,6.5],
// [23.798,-6.5,23.798,6.5],
// [23.297,-6.5,23.297,6.5],
// [22.796,-6.5,22.796,6.5],
// [22.295,-6.5,22.295,6.5],
// [21.794,-6.5,21.794,6.5],
// [21.293,-6.5,21.293,6.5],
// [20.792,-6.5,20.792,6.5],
// [20.291,-6.5,20.291,6.5],
// [19.79,-6.5,19.79,6.5],
// [19.289,-6.5,19.289,6.5],
// [18.788,-6.5,18.788,6.5],
// [18.287,-6.5,18.287,6.5],
// [17.786,-6.5,17.786,6.5],
// [17.285,-6.5,17.285,6.5],
// [16.784,-6.5,16.784,6.5],
// [16.283,-6.5,16.283,6.5],
// [15.782,-6.5,15.782,6.5],
// [15.281,-6.5,15.281,6.5],
// [14.78,-6.5,14.78,6.5],
// [14.279,-6.5,14.279,6.5],
// [13.778,-6.5,13.778,6.5],
// [13.277,-6.5,13.277,6.5],
// [12.776,-6.5,12.776,6.5],
// [12.275,-6.5,12.275,6.5],
// [11.774,-6.5,11.774,6.5],
// [11.273,-6.5,11.273,6.5],
// [10.772,-6.5,10.772,6.5],
// [10.271,-6.5,10.271,6.5],
// [9.77,-6.5,9.77,6.5],
// [9.269,-6.5,9.269,6.5],
// [8.768,-6.5,8.768,6.5],
// [8.267,-6.5,8.267,6.5],
// [7.766,-6.5,7.766,6.5],
// [7.265,-6.5,7.265,6.5],
// [6.764,-6.5,6.764,6.5],
// [6.263,-6.5,6.263,6.5],
// [5.762,-6.5,5.762,6.5],
// [5.261,-6.5,5.261,6.5],
// [4.76,-6.5,4.76,6.5],
// [4.259,-6.5,4.259,6.5],
// [3.758,-6.5,3.758,6.5],
// [3.257,-6.5,3.257,6.5],
// [2.756,-6.5,2.756,6.5],
// [2.255,-6.5,2.255,6.5],
// [1.754,-6.5,1.754,6.5],
// [1.253,-6.5,1.253,6.5],
// [0.752,-6.5,0.752,6.5],
// [0.251,-6.5,0.251,6.5],
// [-0.25,-6.5,-0.25,6.5],
// [-0.751,-6.5,-0.751,6.5],
// [-1.252,-6.5,-1.252,6.5],
// [-1.753,-6.5,-1.753,6.5],
// [-2.254,-6.5,-2.254,6.5],
// [-2.755,-6.5,-2.755,6.5],
// [-3.256,-6.5,-3.256,6.5],
// [-3.757,-6.5,-3.757,6.5],
// [-4.258,-6.5,-4.258,6.5],
// [-4.759,-6.5,-4.759,6.5],
// [-5.26,-6.5,-5.26,6.5],
// [-5.761,-6.5,-5.761,6.5],
// [-6.262,-6.5,-6.262,6.5],
// [-6.763,-6.5,-6.763,6.5],
// [-7.264,-6.5,-7.264,6.5],
// [-7.765,-6.5,-7.765,6.5],
// [-8.266,-6.5,-8.266,6.5],
// [-8.767,-6.5,-8.767,6.5],
// [-9.268,-6.5,-9.268,6.5],
// [-9.769,-6.5,-9.769,6.5],
// [-10.27,-6.5,-10.27,6.5],
// [-10.771,-6.5,-10.771,6.5],
// [-11.272,-6.5,-11.272,6.5],
// [-11.773,-6.5,-11.773,6.5],
// [-12.274,-6.5,-12.274,6.5],
// [-12.775,-6.5,-12.775,6.5],
// [-13.276,-6.5,-13.276,6.5],
// [-13.777,-6.5,-13.777,6.5],
// [-14.278,-6.5,-14.278,6.5],
// [-14.779,-6.5,-14.779,6.5],
// [-15.28,-6.5,-15.28,6.5],
// [-15.781,-6.5,-15.781,6.5],
// [-16.282,-6.5,-16.282,6.5],
// [-16.783,-6.5,-16.783,6.5],
// [-17.284,-6.5,-17.284,6.5],
// [-17.785,-6.5,-17.785,6.5],
// [-18.286,-6.5,-18.286,6.5],
// [-18.787,-6.5,-18.787,6.5],
// [-19.288,-6.5,-19.288,6.5],
// [-19.789,-6.5,-19.789,6.5],
// [-20.29,-6.5,-20.29,6.5],
// [-20.791,-6.5,-20.791,6.5],
// [-21.292,-6.5,-21.292,6.5],
// [-21.793,-6.5,-21.793,6.5],
// [-22.294,-6.5,-22.294,6.5],
// [-22.795,-6.5,-22.795,6.5],
// [-23.296,-6.5,-23.296,6.5],
// [-23.797,-6.5,-23.797,6.5],
// [-24.298,-6.5,-24.298,6.5],
// [-24.799,-6.5,-24.799,6.5],
// [-25.3,-6.5,-25.3,6.5],
// [-25.801,-6.5,-25.801,6.5],
// [-26.302,-6.5,-26.302,6.5],
// [-26.803,-6.5,-26.803,6.5],
// [-27.304,-6.5,-27.304,6.5],
// [-27.805,-6.5,-27.805,6.5],
// [-28.306,-6.5,-28.306,6.5],
// [-28.807,-6.502,-28.807,6.502],
// [-29.308,-6.506,-29.308,6.506],
// [-29.809,-6.513,-29.809,6.513],
// [-30.31,-6.524,-30.31,6.524],
// [-30.811,-6.536,-30.811,6.536],
// [-31.312,-6.554,-31.312,6.554],
// [-31.813,-6.573,-31.813,6.573],
// [-32.314,-6.598,-32.314,6.598],
// [-32.815,-6.624,-32.815,6.624],
// [-33.316,-6.655,-33.316,6.655],
// [-33.817,-6.688,-33.817,6.688],
// [-34.318,-6.724,-34.318,6.724],
// [-34.819,-6.765,-34.819,6.765],
// [-35.32,-6.807,-35.32,6.807],
// [-35.821,-6.856,-35.821,6.856],
// [-36.322,-6.904,-36.322,6.904],
// [-36.823,-6.959,-36.823,6.959],
// [-37.324,-7.015,-37.324,7.015],
// [-37.825,-7.076,-37.825,7.076],
// [-38.326,-7.14,-38.326,7.14],
// [-38.828,-7.206,-38.828,7.206],
// [-39.329,-7.277,-39.329,7.277],
// [-39.83,-7.35,-39.83,7.35],
// [-40.331,-7.429,-40.331,7.429],
// [-40.832,-7.507,-40.832,7.507],
// [-41.333,-7.593,-41.333,7.593],
// [-41.834,-7.68,-41.834,7.68],
// [-42.335,-7.772,-42.335,7.772],
// [-42.836,-7.866,-42.836,7.866],
// [-43.337,-7.964,-43.337,7.964],
// [-43.838,-8.066,-43.838,8.066],
// [-44.339,-8.17,-44.339,8.17],
// [-44.84,-8.279,-44.84,8.279],
// [-45.341,-8.39,-45.341,8.39],
// [-45.842,-8.507,-45.842,8.507],
// [-46.343,-8.624,-46.343,8.624],
// [-46.844,-8.749,-46.844,8.749],
// [-47.345,-8.874,-47.345,8.874],
// [-47.846,-9.005,-47.846,9.005],
// [-48.347,-9.139,-48.347,9.139],
// [-48.848,-9.276,-48.848,9.276],
// [-49.349,-9.417,-49.349,9.417],
// [-49.85,-9.5,-49.85,9.5],
// [-50.351,-9.5,-50.351,9.5],
// [-50.852,-9.5,-50.852,9.5],
// [-51.353,-9.5,-51.353,9.5],
// [-51.854,-9.5,-51.854,9.5],
// [-52.355,-9.5,-52.355,9.5],
// [-52.856,-9.5,-52.856,9.5],
// [-53.357,-9.5,-53.357,9.5],
// [-53.858,-9.5,-53.858,9.5],
// [-54.359,-9.5,-54.359,9.5],
// [-54.86,-9.5,-54.86,9.5],
// [-55.361,-9.5,-55.361,9.5],
// [-55.862,-9.5,-55.862,9.5],
// [-56.363,-9.5,-56.363,9.5],
// [-56.864,-9.5,-56.864,9.5],
// [-57.365,-9.5,-57.365,9.5],
// [-57.866,-9.5,-57.866,9.5],
// [-58.367,-9.5,-58.367,9.5],
// [-58.868,-9.5,-58.868,9.5],
// [-59.369,-9.5,-59.369,9.5],
// [-59.87,-9.5,-59.87,9.5],
// [-60.371,-9.5,-60.371,9.5],
// [-60.872,-9.5,-60.872,9.5],
// [-61.373,-9.5,-61.373,9.5],
// [-61.874,-9.5,-61.874,9.5],
// [-62.375,-9.5,-62.375,9.5],
// [-62.876,-9.5,-62.876,9.5],
// [-63.377,-9.5,-63.377,9.5],
// [-63.878,-9.5,-63.878,9.5],
// [-64.379,-9.5,-64.379,9.5],
// [-64.88,-9.5,-64.88,9.5],
// [-65.381,-9.5,-65.381,9.5],
// [-65.882,-9.5,-65.882,9.5],
// [-66.383,-9.5,-66.383,9.5],
// [-66.884,-9.5,-66.884,9.5],
// [-67.385,-9.5,-67.385,9.5],
// [-67.886,-9.5,-67.886,9.5],
// [-68.387,-9.5,-68.387,9.5],
// [-68.888,-9.5,-68.888,9.5],
// [-69.389,-9.5,-69.389,9.5],
// [-69.89,-9.5,-69.89,9.5],
// [-70.391,-9.5,-70.391,9.5],
// [-70.892,-9.5,-70.892,9.5],
// [-71.393,-9.5,-71.393,9.5],
// [-71.894,-9.5,-71.894,9.5],
// [-72.395,-9.5,-72.395,9.5],
// [-72.896,-9.5,-72.896,9.5],
// [-73.397,-9.5,-73.397,9.5],
// [-73.898,-9.5,-73.898,9.5],
// [-74.399,-9.5,-74.399,9.5],
// [-74.9,-9.5,-74.9,9.5],
// [-75.401,-9.5,-75.401,9.5],
// [-75.902,-9.5,-75.902,9.5],
// [-76.403,-9.5,-76.403,9.5],
// [-76.904,-9.5,-76.904,9.5],
// [-77.405,-9.5,-77.405,9.5],
// [-77.906,-9.5,-77.906,9.5],
// [-78.407,-9.5,-78.407,9.5],
// [-78.908,-9.5,-78.908,9.5],
// [-79.409,-9.5,-79.409,9.5],
// [-79.91,-9.5,-79.91,9.5],
// [-80.411,-9.5,-80.411,9.5],
// [-80.912,-9.5,-80.912,9.5],
// [-81.413,-9.5,-81.413,9.5],
// [-81.914,-9.5,-81.914,9.5],
// [-82.415,-9.5,-82.415,9.5]];

String.prototype.format = function () {

    var str = this;
    for ( var i = 0; i < arguments.length; i ++ ) {

        str = str.replace( '{' + i + '}', arguments[ i ] );

    }
    return str;

}

var container, stats;
var camera, scene, renderer;
var splineHelperObjects = [],
    splineOutline;
var splinePointsLength = 4;
var positions = [];
var options;

var geometry = new THREE.BoxGeometry( 20, 20, 20 );

var ARC_SEGMENTS = 200;
var splineMesh;

var splines = {

};

init();
animate();

function init() {

    container = document.createElement( 'div' );
    document.body.appendChild( container );
    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 1, 10000 );
    camera.position.z = 250;
    scene.add( camera );

    scene.add( new THREE.AmbientLight( 0xf0f0f0 ) );
    var light = new THREE.SpotLight( 0xffffff, 1.5 );
    light.position.set( 0, 1500, 200 );
    light.castShadow = true;
    light.shadowCameraNear = 200;
    light.shadowCameraFar = camera.far;
    light.shadowCameraFov = 70;
    light.shadowBias = -0.000222;
    light.shadowDarkness = 0.25;
    light.shadowMapWidth = 1024;
    light.shadowMapHeight = 1024;
    scene.add( light );
    spotlight = light;

    var planeGeometry = new THREE.PlaneGeometry( 2000, 2000 );
    planeGeometry.rotateX( - Math.PI / 2 );
    var planeMaterial = new THREE.MeshBasicMaterial( { color: 0xeeeeee } );

    var plane = new THREE.Mesh( planeGeometry, planeMaterial );
    plane.position.y = -20;
    plane.receiveShadow = true;
    scene.add( plane );

    var helper = new THREE.GridHelper( 200, 20 );
    helper.position.y = - 20;
    helper.material.opacity = 0.25;
    helper.material.transparent = true;
    scene.add( helper );

    // var axis = new THREE.AxisHelper();
    // axis.position.set( -500, -500, -500 );
    // scene.add( axis );

    renderer = new THREE.WebGLRenderer( { antialias: true } );
    renderer.setClearColor( 0xf0f0f0 );
    renderer.setSize( window.innerWidth, window.innerHeight );
    renderer.shadowMap.enabled = true;
    container.appendChild( renderer.domElement );

    // var info = document.createElement( 'div' );
    // info.style.position = 'absolute';
    // info.style.top = '10px';
    // info.style.width = '100%';
    // info.style.textAlign = 'center';
    // info.innerHTML = 'catmull-rom rom spline comparisions';
    

    // options.innerHTML = 'Points: <input type="button" onclick="addPoint();" value="+" />\
    //     <input type="button" onclick="removePoint();" value="-" />\
    //     <input type="button" onclick="exportSpline();" value="Export" /><br />\
    //     <input type="checkbox" id="uniform" checked /> <label for="uniform">Uniform Catmull-rom</label>  <input type="range" id="tension" onchange="splines.uniform.tension = tension.value;updateSplineOutline();" min=0 max=1 step=0.01 value=0.5 /> <span id="tension_value" /></span> <br />\
    //     <input type="checkbox" id="centripetal" checked /> Centripetal Catmull-rom<br />\
    //     <input type="checkbox" id="chordal" checked /> Chordal Catmull-rom<br />';

    // container.appendChild( info );
    // container.appendChild( options );

    stats = new Stats();
    stats.domElement.style.position = 'absolute';
    stats.domElement.style.top = '0px';
    container.appendChild( stats.domElement );

    // Controls
    controls = new THREE.OrbitControls( camera, renderer.domElement );
    controls.damping = 0.2;
    controls.addEventListener( 'change', render );

    transformControl = new THREE.TransformControls( camera, renderer.domElement );
    transformControl.addEventListener( 'change', render );

    scene.add( transformControl );



    // Line

    var material = new THREE.LineBasicMaterial({
        color: 0xff0000,
        linewidth: 5
    });

    var line, geometry;
    for ( var i = 0; i < coords.length; i ++ ) {
        geometry = new THREE.Geometry();
        console.log(coords.length);
        geometry.vertices.push(new THREE.Vector3(coords[i][0], 0.0, coords[i][1]));
        geometry.vertices.push(new THREE.Vector3(coords[i][2], 0.0, coords[i][3]));
        line = new THREE.Line(geometry, material);
        line.castShadow = true;
        scene.add(line);
    }
    

    // Hiding transform situation is a little in a mess :()
    // transformControl.addEventListener( 'change', function( e ) {

    //     cancelHideTransorm();

    // } );

    // transformControl.addEventListener( 'mouseDown', function( e ) {

    //     cancelHideTransorm();

    // } );

    // transformControl.addEventListener( 'mouseUp', function( e ) {

    //     delayHideTransform();

    // } );

    // transformControl.addEventListener( 'objectChange', function( e ) {

    //     updateSplineOutline();

    // } );

    // var dragcontrols = new THREE.DragControls( camera, splineHelperObjects, renderer.domElement ); //

    // dragcontrols.on( 'hoveron', function( e ) {

    //     transformControl.attach( e.object );
    //     cancelHideTransorm(); // *

    // } )

    // dragcontrols.on( 'hoveroff', function( e ) {

    //     if ( e ) delayHideTransform();

    // } )


    // controls.addEventListener( 'start', function() {

    //     cancelHideTransorm();

    // } );

    // controls.addEventListener( 'end', function() {

    //     delayHideTransform();

    // } );

    // var hiding;

    // function delayHideTransform() {

    //     cancelHideTransorm();
    //     hideTransform();

    // }
 
    // function hideTransform() {

    //     hiding = setTimeout( function() {

    //         transformControl.detach( transformControl.object );

    //     }, 2500 )

    // }

    // function cancelHideTransorm() {

    //     if ( hiding ) clearTimeout( hiding );

    // }


    /*******
     * Curves
     *********/

    // var i;
    // for ( i = 0; i < splinePointsLength; i ++ ) {

    //     addSplineObject( positions[ i ] );

    // }
    // positions = [];
    // for ( i = 0; i < splinePointsLength; i ++ ) {

    //     positions.push( splineHelperObjects[ i ].position );

    // }

    // var geometry = new THREE.Geometry();

    // for ( var i = 0; i < ARC_SEGMENTS; i ++ ) {

    //     geometry.vertices.push( new THREE.Vector3() );

    // }

    // var curve;


    // curve = new THREE.CatmullRomCurve3( positions );
    // curve.type = 'catmullrom';
    // curve.mesh = new THREE.Line( geometry.clone(), new THREE.LineBasicMaterial( {
    //     color: 0xff0000,
    //     opacity: 0.35,
    //     linewidth: 2
    //     } ) );
    // curve.mesh.castShadow = true;
    // splines.uniform = curve;

    // curve = new THREE.CatmullRomCurve3( positions );
    // curve.type = 'centripetal';
    // curve.mesh = new THREE.Line( geometry.clone(), new THREE.LineBasicMaterial( {
    //     color: 0x00ff00,
    //     opacity: 0.35,
    //     linewidth: 2
    //     } ) );
    // curve.mesh.castShadow = true;
    // splines.centripetal = curve;

    // curve = new THREE.CatmullRomCurve3( positions );
    // curve.type = 'chordal';
    // curve.mesh = new THREE.Line( geometry.clone(), new THREE.LineBasicMaterial( {
    //     color: 0x0000ff,
    //     opacity: 0.35,
    //     linewidth: 2
    //     } ) );
    // curve.mesh.castShadow = true;
    // splines.chordal = curve;

    // for ( var k in splines ) {

    //     var spline = splines[ k ];
    //     scene.add( spline.mesh );

    // }

    // load( [ new THREE.Vector3( 289.76843686945404, 452.51481137238443, 56.10018915737797 ),
    //         new THREE.Vector3( -53.56300074753207, 171.49711742836848, -14.495472686253045 ),
    //         new THREE.Vector3( -91.40118730204415, 176.4306956436485, -6.958271935582161 ),
    //         new THREE.Vector3( -383.785318791128, 491.1365363371675, 47.869296953772746 ) ] );

}

function addSplineObject( position ) {

    var object = new THREE.Mesh( geometry, new THREE.MeshLambertMaterial( {
        color: Math.random() * 0xffffff
        } ) );
    object.material.ambient = object.material.color;
    if ( position ) {

        object.position.copy( position );

    } else {

        object.position.x = Math.random() * 1000 - 500;
        object.position.y = Math.random() * 600
        object.position.z = Math.random() * 800 - 400;

    }

    object.castShadow = true;
    object.receiveShadow = true;
    scene.add( object );
    splineHelperObjects.push( object );
    return object;

}

function addPoint() {

    splinePointsLength ++;
    positions.push( addSplineObject()
                    .position );

    updateSplineOutline();

}

function removePoint() {

    if ( splinePointsLength <= 4 ) {

        return;

    }
    splinePointsLength --;
    positions.pop();
    scene.remove( splineHelperObjects.pop() );

    updateSplineOutline();

}

function updateSplineOutline() {

    var p;

    for ( var k in splines ) {

        var spline = splines[ k ];

        splineMesh = spline.mesh;

        for ( var i = 0; i < ARC_SEGMENTS; i ++ ) {

            p = splineMesh.geometry.vertices[ i ];
            p.copy( spline.getPoint( i /  ( ARC_SEGMENTS - 1 ) ) );

        }

        splineMesh.geometry.verticesNeedUpdate = true;

    }


}

function exportSpline() {

    var p;
    var strplace = [];
    for ( i = 0; i < splinePointsLength; i ++ ) {

        p = splineHelperObjects[ i ].position;
        strplace.push( 'new THREE.Vector3({0}, {1}, {2})'.format( p.x, p.y, p.z ) )

    }
    console.log( strplace.join( ',\n' ) );
    var code = '[' + ( strplace.join( ',\n\t' ) ) + ']';
    prompt( 'copy and paste code', code );

    }

function load( new_positions ) {

    while ( new_positions.length > positions.length ) {

        addPoint();

    }

    while ( new_positions.length < positions.length ) {

        removePoint();

    }

    for ( i = 0; i < positions.length; i ++ ) {

        positions[ i ].copy( new_positions[ i ] );

    }

    updateSplineOutline();

}

function animate() {

    requestAnimationFrame( animate );
    render();
    stats.update();
    controls.update();
    transformControl.update();

}

function render() {

    // splines.uniform.mesh.visible = uniform.checked;
    // splines.centripetal.mesh.visible = centripetal.checked;
    // splines.chordal.mesh.visible = chordal.checked;
    renderer.render( scene, camera );

}

